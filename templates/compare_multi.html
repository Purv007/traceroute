{% extends "base.html" %}
{% block content %}
<h2 class="title">Multi-Scenario Comparison</h2>
<p class="subtitle">Input: {{ msg_len }} bytes • Repeat: {{ repeat }} • Source: {{ src_label }}</p>

<div class="panel">
  <div class="panel-title">Side-by-side</div>
  <div class="overflow-x-auto">
    <table class="tbl">
      <thead>
        <tr>
          <th>Scenario</th>
          <th>Algorithm</th>
          <th class="t-right">Mean (ms)</th>
          <th class="t-right">p95 (ms)</th>
          <th>Ciphertext (b64)</th> <!-- NEW: preview beside the time -->
          <th class="t-center">AEAD</th>
        </tr>
      </thead>
      <tbody>
      {% for r in rows %}
        <tr>
          <td>{{ r.scenario.upper() }}</td>
          <td>{{ r.algo }} {{ r.variant }}</td>
          <td class="t-right">{{ "%.4f"|format(r.mean_ms) }}</td>
          <td class="t-right">{{ "%.4f"|format(r.p95_ms) }}</td>
          <td><code>{{ r.preview or "—" }}</code></td> <!-- NEW -->
          <td class="t-center">{{ "✓" if r.aead else "—" }}</td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<div class="panel mt-6">
  <div class="panel-title">Mean by Scenario (stacked)</div>
  <canvas id="chart" height="220"></canvas>
</div>

<a href="{{ url_for('index') }}" class="btn-secondary mt-6">← Back</a>

<script>
const rows = {{ rows|tojson }};
const scenarios = [...new Set(rows.map(r => r.scenario.toUpperCase()))];
const algos = [...new Set(rows.map(r => r.algo + " " + r.variant))];

// Build dataset for each algo across scenarios
const datasets = algos.map(a => ({
  label: a,
  data: scenarios.map(scn => {
    const item = rows.find(r => (r.scenario.toUpperCase()===scn) && (r.algo + " " + r.variant === a));
    return item ? item.mean_ms : 0;
  })
}));

new Chart(document.getElementById('chart').getContext('2d'), {
  type: 'bar',
  data: { labels: scenarios, datasets },
  options: {responsive:true, plugins:{legend:{labels:{color:'#cbd5e1'}}},
            scales:{x:{ticks:{color:'#cbd5e1'}}, y:{ticks:{color:'#94a3b8'}}}}
});
</script>
{% endblock %}
